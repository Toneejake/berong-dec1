<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SafeScape | Module 1: Fire is a Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../css/shared.css">

    <style>
        /* --- Custom Animations --- */
        .fade-in {
            animation: fadeIn 0.8s ease-out forwards;
            opacity: 0;
            transform: translateY(20px);
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* The Fire Animation */
        .fire-container {
            position: relative;
            width: 100px;
            height: 100px;
        }

        .flame {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 80px;
            background: radial-gradient(circle, #ffeb3b 0%, #ff9800 40%, #f44336 80%);
            border-radius: 50% 50% 20% 20%;
            filter: blur(5px);
            animation: burn 0.5s infinite alternate;
            opacity: 0;
            transition: opacity 0.5s;
        }

        .flame.active {
            opacity: 1;
        }

        @keyframes burn {
            0% {
                transform: translateX(-50%) scale(1) skewX(0deg);
            }

            50% {
                transform: translateX(-50%) scale(1.1) skewX(2deg);
            }

            100% {
                transform: translateX(-50%) scale(0.9) skewX(-2deg);
            }
        }

        /* Drag and Drop Styling */
        .drop-zone {
            transition: all 0.3s ease;
        }

        .drop-zone.drag-over {
            border-color: #fb923c;
            background-color: rgba(251, 146, 60, 0.1);
            transform: scale(1.02);
        }

        .draggable {
            cursor: grab;
        }

        .draggable:active {
            cursor: grabbing;
        }

        .pit-item {
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn {
            from {
                transform: scale(0);
                opacity: 0;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }
    </style>
</head>

<body class="bg-slate-900 text-slate-100 font-sans min-h-screen">

    <!-- NAVIGATION -->
    <nav class="ss-nav">
        <div class="ss-nav-container">
            <a href="../index.html" class="ss-nav-brand">
                <i class="fa-solid fa-shield-cat"></i>
                <h1>SafeScape <span>| Module 1</span></h1>
            </a>
            
            <!-- Module Progress Indicators -->
            <div class="ss-module-indicators">
                <a href="index.html" class="ss-module-dot current" title="Module 1">1</a>
                <div class="ss-module-connector" id="conn-1-2"></div>
                <a href="#" class="ss-module-dot locked" id="nav-2" title="Module 2">2</a>
                <div class="ss-module-connector" id="conn-2-3"></div>
                <a href="#" class="ss-module-dot locked" id="nav-3" title="Module 3">3</a>
                <div class="ss-module-connector" id="conn-3-4"></div>
                <a href="#" class="ss-module-dot locked" id="nav-4" title="Module 4">4</a>
                <div class="ss-module-connector" id="conn-4-5"></div>
                <a href="#" class="ss-module-dot locked" id="nav-5" title="Module 5">5</a>
            </div>

            <div class="text-sm text-slate-400">
                Progress: <span id="module-progress" class="text-orange-400 font-bold">0%</span>
            </div>
        </div>
    </nav>

    <!-- MAIN CONTENT CONTAINER -->
    <main class="max-w-5xl mx-auto p-6 space-y-20">

        <!-- INTRO TEXT -->
        <section id="section-intro" class="fade-in text-center max-w-3xl mx-auto" style="animation-delay: 0.1s;">
            <h1
                class="text-4xl md:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-orange-400 to-red-500 mb-6">
                Fire is a Tool, Not a Toy
            </h1>
            <p class="text-lg text-slate-300 leading-relaxed">
                To be a fire safety hero, the first thing you need to do is understand what fire is and respect its
                power.
                Just like some tools are only for grown-ups to use, fire is also something that needs to be handled with
                great care.
                This module will help you understand why fire is a tool for adults and not a toy for kids.
            </p>
        </section>

        <!-- PART 1: THE HOOK (VIDEO) -->
        <section id="section-video" class="fade-in ss-section" style="animation-delay: 0.2s;">
            <div class="ss-section-badge"><i class="fa-solid fa-check"></i></div>
            <div
                class="w-full aspect-video bg-black rounded-xl overflow-hidden shadow-2xl border border-slate-700 relative group">
                <video id="module-video" controls class="w-full h-full object-cover" onplay="onVideoPlay()">
                    <source src="../assets/videos/m1.mp4" type="video/mp4">
                </video>
            </div>
            <p class="text-center text-slate-500 text-sm mt-2">Watch the video to continue</p>
        </section>

        <!-- PART 2: THE SCIENCE (SECTION 1.1) -->
        <section id="section-1-1" class="fade-in ss-section grid grid-cols-1 md:grid-cols-2 gap-12 items-center" style="animation-delay: 0.3s;">
            <div class="ss-section-badge"><i class="fa-solid fa-check"></i></div>

            <!-- 1.1 Text Content -->
            <div class="order-2 md:order-1 space-y-6">
                <div class="flex items-center gap-3 mb-2">
                    <span class="bg-slate-700 text-orange-400 px-3 py-1 rounded text-sm font-mono">1.1</span>
                    <h2 class="text-3xl font-bold text-white">What Makes a Fire?</h2>
                </div>

                <div class="text-slate-300 space-y-4 leading-relaxed text-lg">
                    <p>
                        Have you ever seen a stool with three legs? If you take one leg away, the stool falls over.
                        <strong>Fire is just like that!</strong> It needs three things to exist, and we call this the
                        "fire triangle."
                        If you take any one of them away, the fire goes out.
                    </p>

                    <ul class="space-y-4 mt-4 bg-slate-800/50 p-6 rounded-xl border border-slate-700">
                        <li class="flex gap-4">
                            <i class="fa-solid fa-fire-burner text-red-400 mt-1"></i>
                            <div>
                                <strong class="text-white block">Heat</strong>
                                <span class="text-sm">This is something hot, like a spark or a flame, that gets the fire
                                    started.</span>
                            </div>
                        </li>
                        <li class="flex gap-4">
                            <i class="fa-solid fa-tree text-amber-400 mt-1"></i>
                            <div>
                                <strong class="text-white block">Fuel</strong>
                                <span class="text-sm">This is anything that can burn, like paper, wood, or cloth.</span>
                            </div>
                        </li>
                        <li class="flex gap-4">
                            <i class="fa-solid fa-wind text-blue-400 mt-1"></i>
                            <div>
                                <strong class="text-white block">Air (Oxygen)</strong>
                                <span class="text-sm">Fire needs to breathe, just like we do! It uses a part of the air
                                    called oxygen to stay alive.</span>
                            </div>
                        </li>
                    </ul>
                </div>
                
                <button onclick="completeSection('section1Read')" class="ss-btn ss-btn-secondary mt-4">
                    <i class="fa-solid fa-check"></i> I understand the Fire Triangle
                </button>
            </div>

            <!-- INFOGRAPHIC CONTAINER -->
            <div class="order-1 md:order-2">
                <div
                    class="bg-white rounded-xl overflow-hidden shadow-lg border-4 border-slate-700 h-96 relative flex items-center justify-center transform rotate-1 hover:rotate-0 transition-transform duration-500">
                    <img src="../../module_1/m1.png" alt="Fire Triangle" class="w-full h-full object-contain">
                </div>
            </div>
        </section>

        <!-- PART 3: THE RULES (SECTION 1.2) -->
        <section id="section-1-2"
            class="fade-in ss-section bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl p-8 md:p-12 border border-slate-700 shadow-2xl relative overflow-hidden"
            style="animation-delay: 0.4s;">
            <div class="ss-section-badge"><i class="fa-solid fa-check"></i></div>
            
            <!-- Background Decoration -->
            <i
                class="fa-solid fa-triangle-exclamation absolute -top-10 -right-10 text-9xl text-slate-800 opacity-50 rotate-12"></i>

            <div class="relative z-10 max-w-4xl mx-auto">
                <div class="flex items-center gap-3 mb-6">
                    <span
                        class="bg-orange-900/50 text-orange-400 px-3 py-1 rounded text-sm font-mono border border-orange-500/30">1.2</span>
                    <h2 class="text-3xl font-bold text-white">Grown-Up Tools</h2>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-lg">
                    <div class="md:col-span-2 text-slate-300 space-y-4 leading-relaxed">
                        <p>
                            You know that grown-ups use special tools for their jobs, like power saws or even cars.
                            These tools are very helpful, but they can be very dangerous if they aren't used correctly,
                            which is why only trained adults are allowed to use them.
                        </p>
                        <p>
                            Matches and lighters are the same. They are tools that grown-ups use to light candles or
                            start a barbecue.
                            They are <span class="text-red-400 font-bold underline decoration-red-500/50">not
                                toys</span>.
                            Because they create heat, they can easily start a dangerous fire if they fall into the wrong
                            hands.
                        </p>
                        
                        <button onclick="completeSection('section2Read')" class="ss-btn ss-btn-secondary mt-4">
                            <i class="fa-solid fa-check"></i> I understand the rules
                        </button>
                    </div>

                    <!-- The Golden Rule Card -->
                    <div
                        class="bg-red-950/40 border border-red-500/30 rounded-xl p-6 flex flex-col items-center justify-center text-center shadow-lg transform hover:scale-105 transition-transform duration-300">
                        <div
                            class="bg-red-500 w-12 h-12 rounded-full flex items-center justify-center mb-4 text-white text-xl">
                            <i class="fa-solid fa-hand"></i>
                        </div>
                        <h3 class="text-red-300 font-bold mb-2 uppercase tracking-wider text-sm">Powerful Rule</h3>
                        <p class="text-white font-medium italic">
                            "If you find matches or a lighter, <span class="text-red-400">do not touch them</span>. Go
                            and tell a grown-up right away."
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- PART 4: THE SIMULATION (GAME) -->
        <section id="section-game" class="fade-in ss-section bg-slate-800 rounded-2xl p-8 shadow-2xl border border-slate-700"
            style="animation-delay: 0.5s;">
            <div class="ss-section-badge"><i class="fa-solid fa-check"></i></div>
            
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold text-white"><i class="fa-solid fa-flask text-purple-400 mr-2"></i> The
                    Element Mixer Lab</h2>
                <p class="text-slate-400 mt-2">By understanding what fire needs to start, you are already taking a huge
                    step in preventing fires.<br>Prove your knowledge by building the Fire Triangle below!</p>
            </div>

            <div class="flex flex-col lg:flex-row gap-10 items-center justify-center select-none">

                <!-- INVENTORY -->
                <div class="grid grid-cols-2 gap-4">
                    <div class="draggable bg-amber-900 hover:bg-amber-800 p-4 rounded-xl border border-amber-700 text-center w-32 shadow-lg transition-transform active:scale-95"
                        draggable="true" ondragstart="drag(event)" id="fuel" data-type="fuel">
                        <i class="fa-solid fa-tree text-3xl text-amber-300 mb-2 pointer-events-none"></i>
                        <p class="font-bold text-amber-100 pointer-events-none">Wood</p>
                        <p class="text-xs text-amber-400 pointer-events-none">Fuel</p>
                    </div>
                    <div class="draggable bg-red-900 hover:bg-red-800 p-4 rounded-xl border border-red-700 text-center w-32 shadow-lg transition-transform active:scale-95"
                        draggable="true" ondragstart="drag(event)" id="heat" data-type="heat">
                        <i class="fa-solid fa-fire-burner text-3xl text-red-300 mb-2 pointer-events-none"></i>
                        <p class="font-bold text-red-100 pointer-events-none">Spark</p>
                        <p class="text-xs text-red-400 pointer-events-none">Heat</p>
                    </div>
                    <div class="draggable bg-blue-900 hover:bg-blue-800 p-4 rounded-xl border border-blue-700 text-center w-32 shadow-lg transition-transform active:scale-95"
                        draggable="true" ondragstart="drag(event)" id="oxygen" data-type="oxygen">
                        <i class="fa-solid fa-wind text-3xl text-blue-300 mb-2 pointer-events-none"></i>
                        <p class="font-bold text-blue-100 pointer-events-none">Fan</p>
                        <p class="text-xs text-blue-400 pointer-events-none">Oxygen</p>
                    </div>
                    <div class="draggable bg-cyan-900 hover:bg-cyan-800 p-4 rounded-xl border border-cyan-700 text-center w-32 shadow-lg transition-transform active:scale-95"
                        draggable="true" ondragstart="drag(event)" id="water" data-type="water">
                        <i class="fa-solid fa-bucket text-3xl text-cyan-300 mb-2 pointer-events-none"></i>
                        <p class="font-bold text-cyan-100 pointer-events-none">Water</p>
                        <p class="text-xs text-cyan-400 pointer-events-none">Remover</p>
                    </div>
                </div>

                <!-- THE FIRE PIT -->
                <div class="relative">
                    <div id="pit"
                        class="drop-zone w-72 h-72 rounded-full border-4 border-dashed border-slate-600 bg-slate-900 flex flex-col items-center justify-center relative overflow-hidden"
                        ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)">
                        <div id="flame-effect" class="flame z-20"></div>
                        <p id="pit-placeholder" class="text-slate-600 font-bold z-10 pointer-events-none">DROP ITEMS
                            HERE</p>
                        <div id="active-items"
                            class="absolute inset-0 flex items-center justify-center gap-2 z-30 pointer-events-none">
                        </div>
                    </div>
                    <div class="text-center mt-4 h-12">
                        <p id="game-status" class="text-slate-400 transition-colors duration-300">The pit is empty.</p>
                    </div>
                    <div class="text-center mt-2">
                        <button onclick="resetPit()" class="text-xs text-slate-500 hover:text-white underline">Clear Pit
                            & Restart</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- MODULE COMPLETE / NEXT MODULE -->
        <section id="section-complete" class="fade-in text-center py-12 hidden">
            <div class="bg-green-900/30 border border-green-500 rounded-2xl p-8 max-w-xl mx-auto">
                <i class="fa-solid fa-circle-check text-6xl text-green-500 mb-4"></i>
                <h2 class="text-3xl font-bold text-white mb-2">Module 1 Complete!</h2>
                <p class="text-slate-300 mb-6">Great job! You've learned about the Fire Triangle and why fire tools are for grown-ups only.</p>
                <a href="../module_2/index.html" id="next-module-btn" class="ss-btn ss-btn-primary text-lg">
                    Continue to Module 2 <i class="fa-solid fa-arrow-right ml-2"></i>
                </a>
            </div>
        </section>

    </main>

    <!-- FOOTER -->
    <footer class="bg-slate-950 text-slate-500 py-8 text-center text-sm border-t border-slate-800 mt-12">
        <p>SafeScape Intelligent Systems Project</p>
        <p class="mt-2 text-xs opacity-50">Module 1: Fire is a Tool, Not a Toy</p>
    </footer>

    <!-- Toast Container -->
    <div class="ss-toast-container" id="toast-container"></div>

    <!-- JAVASCRIPT LOGIC -->
    <script src="../js/progress.js"></script>
    <script>
        // --- MODULE STATE ---
        const moduleNum = 1;
        let localState = {
            videoWatched: false,
            section1Read: false,
            section2Read: false,
            elementMixerCompleted: false
        };

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            loadProgress();
            updateNavigation();
            updateSectionStates();
        });

        function loadProgress() {
            const progress = SafeScapeProgress.getProgress();
            const moduleData = progress[`module${moduleNum}`];
            if (moduleData && moduleData.sections) {
                localState = { ...localState, ...moduleData.sections };
            }
            updateModuleProgress();
        }

        function saveLocalProgress() {
            Object.keys(localState).forEach(key => {
                SafeScapeProgress.completeSection(moduleNum, key, localState[key]);
            });
            updateModuleProgress();
            updateSectionStates();
            checkModuleComplete();
        }

        function updateModuleProgress() {
            const completed = Object.values(localState).filter(v => v === true).length;
            const total = Object.keys(localState).length;
            const percent = Math.round((completed / total) * 100);
            document.getElementById('module-progress').textContent = `${percent}%`;
        }

        // --- SECTION COMPLETION ---
        function completeSection(sectionKey) {
            if (!localState[sectionKey]) {
                localState[sectionKey] = true;
                saveLocalProgress();
                showToast('success', 'Section completed!');
            }
        }

        function onVideoPlay() {
            if (!localState.videoWatched) {
                localState.videoWatched = true;
                saveLocalProgress();
                showToast('success', 'Video started! Keep watching.');
            }
        }

        function updateSectionStates() {
            // Mark completed sections
            if (localState.videoWatched) {
                document.getElementById('section-video').classList.add('completed');
            }
            if (localState.section1Read) {
                document.getElementById('section-1-1').classList.add('completed');
            }
            if (localState.section2Read) {
                document.getElementById('section-1-2').classList.add('completed');
            }
            if (localState.elementMixerCompleted) {
                document.getElementById('section-game').classList.add('completed');
            }
        }

        function checkModuleComplete() {
            if (localState.elementMixerCompleted) {
                document.getElementById('section-complete').classList.remove('hidden');
            }
        }

        // --- NAVIGATION UPDATE ---
        function updateNavigation() {
            const progress = SafeScapeProgress.getProgress();
            
            for (let i = 2; i <= 5; i++) {
                const navDot = document.getElementById(`nav-${i}`);
                const connector = document.getElementById(`conn-${i-1}-${i}`);
                const moduleData = progress[`module${i}`];
                
                if (moduleData?.unlocked) {
                    navDot.classList.remove('locked');
                    navDot.classList.add('unlocked');
                    navDot.href = `../module_${i}/index.html`;
                    
                    if (moduleData?.completed) {
                        navDot.classList.add('completed');
                        navDot.innerHTML = '<i class="fa-solid fa-check"></i>';
                    }
                }
                
                // Update connector
                if (progress[`module${i-1}`]?.completed && connector) {
                    connector.classList.add('active');
                }
            }
        }

        // --- ELEMENT MIXER GAME ---
        const pitState = { fuel: false, heat: false, oxygen: false };

        function allowDrop(ev) { ev.preventDefault(); document.getElementById('pit').classList.add('drag-over'); }
        function dragLeave(ev) { document.getElementById('pit').classList.remove('drag-over'); }
        function drag(ev) {
            ev.dataTransfer.setData("type", ev.target.dataset.type);
            ev.dataTransfer.setData("icon", ev.target.querySelector('i').className);
        }

        function drop(ev) {
            ev.preventDefault();
            document.getElementById('pit').classList.remove('drag-over');
            const type = ev.dataTransfer.getData("type");
            const iconClass = ev.dataTransfer.getData("icon");
            handleItemDrop(type, iconClass);
        }

        function handleItemDrop(type, iconClass) {
            const statusEl = document.getElementById('game-status');
            if (type === 'water') {
                if (pitState.heat) {
                    pitState.heat = false;
                    updateVisuals("removed", "heat");
                    statusEl.innerText = "ðŸ’¦ Sizzle! Water removed the Heat.";
                    statusEl.className = "text-cyan-400 font-bold";
                } else {
                    statusEl.innerText = "Water added, but there was no heat to cool.";
                    statusEl.className = "text-slate-400";
                }
                checkFire();
                return;
            }
            if (!pitState[type]) {
                pitState[type] = true;
                const itemContainer = document.getElementById('active-items');
                const span = document.createElement('span');
                span.className = `pit-item text-2xl p-2 rounded-full bg-slate-800 shadow-md border border-slate-600 ${iconClass}`;
                span.id = `visual-${type}`;
                if (type === 'fuel') span.classList.add('text-amber-400');
                if (type === 'heat') span.classList.add('text-red-400');
                if (type === 'oxygen') span.classList.add('text-blue-400');
                itemContainer.appendChild(span);
                statusEl.innerText = `Added ${type.toUpperCase()}.`;
                statusEl.className = "text-slate-300";
            } else {
                statusEl.innerText = `You already have ${type}.`;
                statusEl.className = "text-slate-500";
            }
            checkFire();
        }

        function updateVisuals(action, type) {
            if (action === "removed") {
                const el = document.getElementById(`visual-${type}`);
                if (el) el.remove();
            }
        }

        function checkFire() {
            const flame = document.getElementById('flame-effect');
            const statusEl = document.getElementById('game-status');
            const pit = document.getElementById('pit');

            if (pitState.fuel && pitState.heat && pitState.oxygen) {
                flame.classList.add('active');
                statusEl.innerHTML = "<i class='fa-solid fa-triangle-exclamation'></i> FIRE STARTED! The Triangle is complete!";
                statusEl.className = "text-orange-500 font-bold animate-pulse";
                pit.classList.add('border-orange-500');
                pit.classList.remove('border-slate-600');
                
                // Mark game as completed
                if (!localState.elementMixerCompleted) {
                    localState.elementMixerCompleted = true;
                    saveLocalProgress();
                    showToast('success', 'ðŸŽ‰ Element Mixer completed! Module 1 done!');
                }
            } else {
                flame.classList.remove('active');
                pit.classList.remove('border-orange-500');
                pit.classList.add('border-slate-600');
                if (pitState.fuel || pitState.heat || pitState.oxygen) {
                    let missing = [];
                    if (!pitState.fuel) missing.push("Fuel");
                    if (!pitState.heat) missing.push("Heat");
                    if (!pitState.oxygen) missing.push("Oxygen");
                    if (missing.length > 0 && missing.length < 3) {
                        statusEl.innerText = `No fire yet. Missing: ${missing.join(', ')}.`;
                        statusEl.className = "text-slate-400";
                    }
                }
            }
            const hasItems = pitState.fuel || pitState.heat || pitState.oxygen;
            document.getElementById('pit-placeholder').style.opacity = hasItems ? '0' : '1';
        }

        function resetPit() {
            pitState.fuel = false; pitState.heat = false; pitState.oxygen = false;
            document.getElementById('active-items').innerHTML = '';
            document.getElementById('game-status').innerText = "Pit cleared.";
            document.getElementById('game-status').className = "text-slate-400";
            checkFire();
        }

        // --- TOAST ---
        function showToast(type, message) {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `ss-toast ${type}`;
            const icon = type === 'success' ? 'fa-check-circle' : 'fa-info-circle';
            toast.innerHTML = `<i class="fa-solid ${icon}"></i> ${message}`;
            container.appendChild(toast);
            setTimeout(() => {
                toast.style.animation = 'slideIn 0.3s ease-out reverse';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
    </script>
</body>

</html>
